name: convert

on:
  schedule:
    - [span_7](start_span)cron: '0 7,15 * * *'[span_7](end_span)
  [span_8](start_span)workflow_dispatch:[span_8](end_span)

jobs:
  convert:
    [span_9](start_span)runs-on: ubuntu-latest[span_9](end_span)
    steps:
      - name: Checkout
        [span_10](start_span)uses: actions/checkout@v4[span_10](end_span)
        with:
          [span_11](start_span)fetch-depth: 0[span_11](end_span)

      - name: Download Sources
        run: |
          # [span_12](start_span)下载文件[span_12](end_span)
          [span_13](start_span)curl -fsSL -o reward.txt https://edge.microsoft.com/abusiveadblocking/api/v1/blocklist[span_13](end_span)
          [span_14](start_span)if [ -n "${{ secrets.ALL_SOURCE }}" ]; then[span_14](end_span)
            [span_15](start_span)curl -fsSL -o all.txt "${{ secrets.ALL_SOURCE }}"[span_15](end_span)
          [span_16](start_span)fi[span_16](end_span)

      - name: Generate Adblock Lists
        run: |
          # [span_17](start_span)使用 Python 脚本处理转换[span_17](end_span)
          [span_18](start_span)python3 scripts/extract.py reward.txt adblock_reward.txt[span_18](end_span)
          if [ -f all.txt ]; then
            python3 scripts/extract.py all.txt adblock_all.txt
          fi

      - name: Check for Changes & Commit
        [span_19](start_span)uses: stefanzweifel/git-auto-commit-action@v5[span_19](end_span)
        with:
          [span_20](start_span)commit_message: "Auto-update: Adblock format lists [$(date +'%Y-%m-%d %H:%M')]"[span_20](end_span)
          [span_21](start_span)file_pattern: "*.txt"[span_21](end_span)
